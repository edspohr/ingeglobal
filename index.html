<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingeglobal - Portal de Clientes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="img/logo.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #login-video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            z-index: -1;
            object-fit: cover;
            filter: brightness(0.5); /* Oscurecemos el video para mejor contraste */
        }
        .view {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .sidebar-link {
            transition: all 0.2s ease;
        }
        .sidebar-link:hover {
            background-color: #4A6582; /* Azul pizarra */
            color: white;
            transform: translateX(4px);
        }
        .sidebar-link.active {
            background-color: #D4A24E; /* Dorado */
            color: #111827; /* Texto oscuro para contraste */
            font-weight: 600;
            transform: translateX(4px);
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }
        .table th {
            font-weight: 600;
        }
        .table td, .table th {
            padding: 1rem 1.5rem;
            text-align: left;
        }
        /* Estilos para el logo con sombra */
        .logo-shadow {
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6)); /* Sombra blanca sutil */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <!-- =========== VISTA DE LOGIN =========== --><div id="loginView" class="view active">
        <video autoplay muted loop id="login-video">
            <source src="vid/login.mp4" type="video/mp4">
            Tu navegador no soporta videos HTML5.
        </video>
        <div class="flex items-center justify-center min-h-screen bg-black bg-opacity-30">
            <div class="bg-gray-800 bg-opacity-90 backdrop-blur-sm p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-md m-4 text-center transform transition-all duration-500 hover:scale-105 border border-gray-700">
                <img src="img/logo.png" alt="Logo Ingeglobal" class="mx-auto mb-8 h-40 logo-shadow">
                
                <h2 class="text-2xl font-bold text-white mb-2">Portal de Clientes</h2>
                <p class="text-gray-400 mb-8">Accede a tus datos de medici√≥n.</p>

                <form id="loginForm">
                    <div class="mb-4 text-left">
                        <label for="email" class="block text-sm font-medium text-gray-400 mb-1">Usuario</label>
                        <input type="text" id="email" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-[#D4A24E] focus:border-[#D4A24E] transition text-white" placeholder="admin o user">
                    </div>
                    <div class="mb-6 text-left">
                        <label for="password" class="block text-sm font-medium text-gray-400 mb-1">Contrase√±a</label>
                        <input type="password" id="password" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-[#D4A24E] focus:border-[#D4A24E] transition text-white" placeholder="123">
                    </div>

                    <button type="submit" class="w-full bg-[#D4A24E] text-gray-900 py-2.5 rounded-lg font-semibold hover:bg-[#E4B56E] focus:outline-none focus:ring-4 focus:ring-[#d4a24e]/50 btn">
                        Ingresar
                    </button>
                </form>

                <div class="my-6 flex items-center">
                    <div class="flex-grow border-t border-gray-600"></div>
                    <span class="flex-shrink mx-4 text-gray-500 text-sm">O</span>
                    <div class="flex-grow border-t border-gray-600"></div>
                </div>

                <button disabled class="w-full bg-gray-700 text-gray-500 py-2.5 rounded-lg font-semibold flex items-center justify-center cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.022,35.138,44,30.024,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                    Ingresar con Google
                </button>
            </div>
        </div>
    </div>

    <!-- =========== VISTA DE DASHBOARD (ADMIN Y USUARIO) =========== --><div id="dashboardView" class="view">
        <div class="flex h-screen">
            <!-- Sidebar --><aside class="w-64 bg-[#111827] text-gray-400 flex flex-col">
                <div class="h-20 flex items-center justify-center border-b border-gray-700">
                    <img src="img/logo.png" alt="Logo Ingeglobal" class="h-12 logo-shadow">
                </div>
                <nav id="sidebarNav" class="flex-1 px-4 py-6 space-y-2"></nav>
                <div class="px-4 py-4 border-t border-gray-700">
                    <div id="user-info" class="flex items-center">
                        <i data-feather="user" class="w-8 h-8 mr-3 text-gray-500"></i>
                        <div>
                            <p class="font-semibold text-sm text-white" id="userName">Cargando...</p>
                            <p class="text-xs text-gray-500" id="userRole">Cargando...</p>
                        </div>
                    </div>
                    <button id="logoutButton" class="w-full mt-4 flex items-center justify-center text-sm text-gray-400 hover:text-white bg-gray-700 hover:bg-red-600 rounded-md py-2 transition-colors">
                        <i data-feather="log-out" class="w-4 h-4 mr-2"></i>
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </aside>

            <!-- Main Content --><main class="flex-1 flex flex-col overflow-hidden">
                <header class="h-20 bg-gray-800 border-b border-gray-700 flex items-center justify-between px-8">
                    <h1 class="text-2xl font-bold text-white" id="main-title">Dashboard</h1>
                    <div id="admin-controls" class="hidden items-center space-x-4">
                        <label for="client-select" class="text-sm font-medium text-gray-400">Seleccionar Cliente:</label>
                        <select id="client-select" class="bg-gray-700 border border-gray-600 rounded-md px-3 py-1.5 text-sm text-white focus:ring-2 focus:ring-[#D4A24E] focus:border-[#D4A24E]">
                        </select>
                    </div>
                </header>
                <div class="flex-1 overflow-y-auto p-8 bg-gray-900">
                    <!-- Contenido din√°mico del dashboard --><div id="dashboard-content"></div>
                </div>
            </main>
        </div>
    </div>


    <script>
        // --- DATA DE EJEMPLO (Simula la data que vendr√≠a de Supabase) ---
        const mockData = {
            clients: {
                'cliente_a': {
                    name: "Constructora Andina",
                    analytics: {
                        totalVolume: 12580, // m¬≥
                        avgMoisture: 12.5, // %
                        lastTruck: { id: "AB-CD-12", volume: 22, time: "14:30" },
                        stockpiles: [
                            { name: "Acopio A1 (Arena)", volume: 4500, moisture: 11.2 },
                            { name: "Acopio B2 (Grava)", volume: 8080, moisture: 13.8 },
                        ],
                        history: {
                            labels: ["Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b", "Dom"],
                            volumes: [12200, 12350, 12300, 12450, 12500, 12550, 12580]
                        }
                    },
                    users: [
                        { id: 1, name: "Juan P√©rez", email: "juan.perez@andina.cl", active: true },
                        { id: 2, name: "Ana Torres", email: "ana.torres@andina.cl", active: true },
                        { id: 3, name: "Carlos Soto", email: "carlos.soto@andina.cl", active: false },
                    ]
                },
                'cliente_b': {
                    name: "Minerals del Pac√≠fico",
                    analytics: {
                        totalVolume: 38900,
                        avgMoisture: 8.2,
                        lastTruck: { id: "XY-ZW-34", volume: 30, time: "15:05" },
                        stockpiles: [
                            { name: "Pila Norte (Cobre)", volume: 21200, moisture: 7.9 },
                            { name: "Pila Sur (Cobre)", volume: 17700, moisture: 8.5 },
                        ],
                        history: {
                            labels: ["Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b", "Dom"],
                            volumes: [38100, 38150, 38300, 38550, 38700, 38850, 38900]
                        }
                    },
                    users: [
                        { id: 4, name: "Sof√≠a Castro", email: "scastro@pacifico.min", active: true }
                    ]
                }
            }
        };

        const plantaLoBlanco = {
            general: {
                dailyProduction: 3980,
                weeklyProduction: 27860,
                monthlyProduction: 112540,
                efficiency: 92,
                alerts: [
                    "Sobrecarga en cinta transportadora principal",
                    "Desviaci√≥n de humedad detectada en l√≠nea secundaria"
                ]
            },
            dashboard1: {
                flowRates: {
                    arena: 1.32,
                    gravilla: 0.99,
                    grava: 0.82,
                    otros: 0.16
                },
                accumulators: {
                    hourly: 475,
                    daily: 4380,
                    monthly: 118200
                },
                lineChart: {
                    labels: ["08:00", "09:00", "10:00", "11:00", "12:00", "13:00"],
                    datasets: {
                        Arena: [1.18, 1.25, 1.34, 1.32, 1.29, 1.3],
                        Gravilla: [0.9, 0.94, 0.99, 1.01, 0.97, 0.99],
                        Grava: [0.76, 0.8, 0.83, 0.85, 0.82, 0.82],
                        Otros: [0.14, 0.15, 0.17, 0.16, 0.15, 0.16]
                    }
                },
                heatmap: [
                    { cinta: "Arena", status: "Estable", level: "bg-green-500/10", text: "text-green-400" },
                    { cinta: "Gravilla", status: "Vibraci√≥n alta", level: "bg-yellow-500/10", text: "text-yellow-400" },
                    { cinta: "Grava", status: "Detenci√≥n breve", level: "bg-red-500/10", text: "text-red-400" },
                    { cinta: "Otros", status: "Monitoreo preventivo", level: "bg-blue-500/10", text: "text-blue-400" }
                ]
            },
            dashboard2: {
                arcones: [
                    { id: "Arcon #1", inicial: 8400, final: 7680, consumo: 720 },
                    { id: "Arcon #2", inicial: 6250, final: 5980, consumo: 270 }
                ],
                reposicion: "Proyecci√≥n de reposici√≥n autom√°tica programada cada 12 horas."
            },
            dashboard3: {
                operationalTrucks: 18,
                averageTrips: 112,
                dailyTonnage: 2450,
                companies: ["Polpai", "Aridtech", "Translo"],
                highlightedTruck: {
                    plate: "GHYB-72",
                    material: "Gravilla 20 mm",
                    capacity: 18,
                    dailyRuns: 6,
                    weeklyVolume: 648
                }
            },
            dashboard4: {
                dailyVolume: 1280,
                perMinute: 0.95,
                weeklyAverage: 8920,
                anomalies: ["Variaci√≥n de granulometr√≠a superior al 7%"],
                composition: {
                    labels: ["Arena gruesa", "Gravilla 10 mm", "Filler"],
                    values: [42, 38, 20]
                },
                hourlyPerformance: {
                    labels: ["08:00", "10:00", "12:00", "14:00", "16:00", "18:00"],
                    values: [0.92, 0.97, 0.95, 0.98, 0.94, 0.96]
                }
            },
            dashboard5: {
                stockpiles: [
                    { producto: "Arena", cota: 384, volumen: 15848, variacion: -3 },
                    { producto: "Filler", cota: 72, volumen: 552, variacion: 5 },
                    { producto: "Integral Grande", cota: 0, volumen: 31792, variacion: 0 },
                    { producto: "Gravilla 20mm", cota: 0, volumen: 18677, variacion: 2 },
                    { producto: "Bajo Integral", cota: 0, volumen: 4631, variacion: -6 }
                ],
                notes: [
                    "Modelo 3D interactivo con topograf√≠a generada por dron DJI M300 RTK.",
                    "Alertas autom√°ticas para sobrellenado y compactaci√≥n irregular basadas en series hist√≥ricas."
                ]
            },
            dashboard6: {
                monthlyProduction: 112540,
                projectedRevenue: 188000000,
                averageCost: 1420,
                operatingMargin: 34,
                droneStatus: "DJI M300 RTK ‚Äî √öltimo vuelo 10/11/2025",
                sensorsOnline: { active: 18, total: 20 }
            }
        };

        const users = {
            'admin': { role: 'admin', name: "Admin Ingeglobal" },
            'user': { role: 'user', name: "Juan P√©rez", clientId: 'cliente_a' }
        };

        // --- MANEJO DE ESTADO DE LA APP ---
        let currentUser = null;
        let currentClient = 'cliente_a'; 
        let currentView = 'login';
        let mainChart = null;
        let arconesChart = null;
        let buzonPieChart = null;
        let buzonTrendChart = null;

        // --- RENDERIZADO DE VISTAS ---
        const loginView = document.getElementById('loginView');
        const dashboardView = document.getElementById('dashboardView');
        const dashboardContent = document.getElementById('dashboard-content');
        
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(`${viewName}View`).classList.add('active');
            currentView = viewName;
        }
        
        // --- L√ìGICA DE LOGIN ---
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('email').value.toLowerCase();
            const password = document.getElementById('password').value; 

            if (users[username] && password === '123') {
                currentUser = users[username];
                initDashboard();
                switchView('dashboard');
            } else {
                alert('Credenciales incorrectas. Intenta con "admin" o "user" y contrase√±a "123".');
            }
        });
        
        document.getElementById('logoutButton').addEventListener('click', () => {
             currentUser = null;
             document.getElementById('email').value = '';
             document.getElementById('password').value = '';
             switchView('login');
        });

        // --- INICIALIZACI√ìN DEL DASHBOARD ---
        function initDashboard() {
            const userNameEl = document.getElementById('userName');
            const userRoleEl = document.getElementById('userRole');
            const adminControls = document.getElementById('admin-controls');
            const sidebarNav = document.getElementById('sidebarNav');

            userNameEl.textContent = currentUser.name;
            sidebarNav.innerHTML = ''; 

            if (currentUser.role === 'admin') {
                userRoleEl.textContent = "Administrador";
                adminControls.classList.remove('hidden');
                adminControls.classList.add('flex');
                populateClientSelector();
                
                sidebarNav.innerHTML = `
                    <a href="#" data-content="analytics" class="sidebar-link flex items-center px-4 py-2.5 rounded-md active"><i data-feather="bar-chart-2" class="w-5 h-5 mr-3"></i> Anal√≠tica</a>
                    <a href="#" data-content="users" class="sidebar-link flex items-center px-4 py-2.5 rounded-md"><i data-feather="users" class="w-5 h-5 mr-3"></i> Gesti√≥n de Usuarios</a>
                `;
                
                document.getElementById('client-select').addEventListener('change', (e) => {
                    currentClient = e.target.value;
                    renderAnalytics();
                });

                renderAnalytics();

            } else { 
                const clientData = mockData.clients[currentUser.clientId];
                userRoleEl.textContent = clientData.name;
                adminControls.classList.add('hidden');
                
                sidebarNav.innerHTML = `
                    <a href="#" data-content="analytics" class="sidebar-link flex items-center px-4 py-2.5 rounded-md active"><i data-feather="bar-chart-2" class="w-5 h-5 mr-3"></i> Mis Mediciones</a>
                    <a href="#" data-content="reports" class="sidebar-link flex items-center px-4 py-2.5 rounded-md"><i data-feather="file-text" class="w-5 h-5 mr-3"></i> Reportes</a>
                    <a href="#" data-content="profile" class="sidebar-link flex items-center px-4 py-2.5 rounded-md"><i data-feather="settings" class="w-5 h-5 mr-3"></i> Mi Perfil</a>
                `;
                currentClient = currentUser.clientId;
                renderAnalytics();
            }

            feather.replace();
            setupSidebarNavigation();
        }

        function populateClientSelector() {
            const select = document.getElementById('client-select');
            select.innerHTML = '';
            Object.keys(mockData.clients).forEach(clientId => {
                const option = document.createElement('option');
                option.value = clientId;
                option.textContent = mockData.clients[clientId].name;
                select.appendChild(option);
            });
            select.value = currentClient;
        }
        
        function setupSidebarNavigation() {
            const links = document.querySelectorAll('.sidebar-link');
            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    links.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    const contentId = link.getAttribute('data-content');
                    
                    switch(contentId) {
                        case 'analytics': renderAnalytics(); break;
                        case 'users': renderUserManagement(); break;
                        case 'reports': renderPlaceholder("Gesti√≥n de Reportes"); break;
                        case 'profile': renderPlaceholder("Configuraci√≥n de Perfil"); break;
                    }
                });
            });
        }
        
        function renderPlaceholder(title) {
            document.getElementById('main-title').textContent = title;
            dashboardContent.innerHTML = `
                <div class="bg-gray-800 p-8 rounded-lg shadow-lg text-center border border-gray-700">
                    <h2 class="text-xl font-semibold text-white">Pr√≥ximamente</h2>
                    <p class="text-gray-400 mt-2">Esta secci√≥n estar√° disponible en futuras actualizaciones.</p>
                </div>
            `;
        }

        // --- RENDERIZADO DE CONTENIDO DEL DASHBOARD ---

        function renderAnalytics() {
            document.getElementById('main-title').textContent = "Monitoreo Integral Planta Lo Blanco";

            dashboardContent.innerHTML = `
                <section class="mb-10">
                    <h2 class="text-xl font-semibold text-white flex items-center"><span class="text-2xl mr-2">üß≠</span>Panel General ‚Äî Planta Lo Blanco</h2>
                    <p class="text-gray-400 mt-2">Vista panor√°mica del rendimiento operativo de la planta de √°ridos medida por Ingeglobal. Centraliza informaci√≥n de drones, sensores volum√©tricos y controladores industriales.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-4 mt-6">
                        <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Producci√≥n diaria total</p>
                            <p class="text-3xl font-bold text-white">${plantaLoBlanco.general.dailyProduction.toLocaleString('es-CL')} m¬≥</p>
                        </div>
                        <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Producci√≥n semanal</p>
                            <p class="text-3xl font-bold text-white">${plantaLoBlanco.general.weeklyProduction.toLocaleString('es-CL')} m¬≥</p>
                        </div>
                        <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Producci√≥n mensual</p>
                            <p class="text-3xl font-bold text-white">${plantaLoBlanco.general.monthlyProduction.toLocaleString('es-CL')} m¬≥</p>
                        </div>
                        <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Eficiencia promedio planta</p>
                            <p class="text-3xl font-bold text-green-400">${plantaLoBlanco.general.efficiency}%</p>
                        </div>
                        <div class="bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Alertas activas</p>
                            <p class="text-3xl font-bold text-red-400">${plantaLoBlanco.general.alerts.length}</p>
                            <ul class="mt-2 text-xs text-gray-400 space-y-1">
                                ${plantaLoBlanco.general.alerts.map(alert => `<li class="flex items-start"><span class="text-red-500 mr-2">‚Ä¢</span>${alert}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </section>

                <section class="mb-10">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white flex items-center"><span class="text-2xl mr-2">ü™ú</span>Dashboard 1 ‚Äî Medici√≥n de Volumen en Cintas Transportadoras</h3>
                        <span class="text-xs text-gray-500 uppercase tracking-wide">Actualizaci√≥n continua</span>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Arena</p>
                                    <p class="text-2xl font-bold text-white">${plantaLoBlanco.dashboard1.flowRates.arena.toFixed(2)} m¬≥/min</p>
                                </div>
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Gravilla</p>
                                    <p class="text-2xl font-bold text-white">${plantaLoBlanco.dashboard1.flowRates.gravilla.toFixed(2)} m¬≥/min</p>
                                </div>
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Grava</p>
                                    <p class="text-2xl font-bold text-white">${plantaLoBlanco.dashboard1.flowRates.grava.toFixed(2)} m¬≥/min</p>
                                </div>
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Otros</p>
                                    <p class="text-2xl font-bold text-white">${plantaLoBlanco.dashboard1.flowRates.otros.toFixed(2)} m¬≥/min</p>
                                </div>
                            </div>
                            <div class="chart-container h-72"><canvas id="flowChart"></canvas></div>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-6 text-sm text-gray-300">
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Acumulado horario</p>
                                    <p class="text-xl font-semibold text-white">${plantaLoBlanco.dashboard1.accumulators.hourly.toLocaleString('es-CL')} m¬≥</p>
                                </div>
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Acumulado diario</p>
                                    <p class="text-xl font-semibold text-white">${plantaLoBlanco.dashboard1.accumulators.daily.toLocaleString('es-CL')} m¬≥</p>
                                </div>
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Acumulado mensual</p>
                                    <p class="text-xl font-semibold text-white">${plantaLoBlanco.dashboard1.accumulators.monthly.toLocaleString('es-CL')} m¬≥</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <h4 class="text-md font-semibold text-white mb-4">Mapa de calor ‚Äî Vibraci√≥n y detenciones</h4>
                            <div class="space-y-4">
                                ${plantaLoBlanco.dashboard1.heatmap.map(item => `
                                    <div class="p-4 rounded-md ${item.level} border border-gray-700/50">
                                        <div class="flex items-center justify-between">
                                            <span class="font-semibold text-white">${item.cinta}</span>
                                            <span class="text-xs ${item.text}">${item.status}</span>
                                        </div>
                                        <p class="text-xs text-gray-400 mt-2">Sensores de vibraci√≥n y temperatura monitoreando en tiempo real.</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-10">
                    <h3 class="text-lg font-semibold text-white flex items-center mb-4"><span class="text-2xl mr-2">üß±</span>Dashboard 2 ‚Äî Medici√≥n de Volumen en Arcones</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="text-left text-gray-400 border-b border-gray-700">
                                            <th class="py-2">Arcon</th>
                                            <th class="py-2">Volumen inicial</th>
                                            <th class="py-2">Volumen final</th>
                                            <th class="py-2">Consumo diario</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${plantaLoBlanco.dashboard2.arcones.map(arcon => `
                                            <tr class="border-b border-gray-800 text-gray-200">
                                                <td class="py-3 font-semibold">${arcon.id}</td>
                                                <td class="py-3">${arcon.inicial.toLocaleString('es-CL')} m¬≥</td>
                                                <td class="py-3">${arcon.final.toLocaleString('es-CL')} m¬≥</td>
                                                <td class="py-3 text-[#D4A24E] font-medium">${arcon.consumo.toLocaleString('es-CL')} m¬≥</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            <div class="chart-container h-64 mt-6"><canvas id="arconesChart"></canvas></div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg flex flex-col justify-between">
                            <p class="text-gray-300 text-sm leading-relaxed">${plantaLoBlanco.dashboard2.reposicion}</p>
                            <div class="mt-6 p-4 bg-gray-900/40 rounded-md text-xs text-gray-400">
                                <p>Algoritmo de reposici√≥n sugiere √≥rdenes autom√°ticas cuando el volumen proyectado alcanza el 30% del stock inicial.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-10">
                    <h3 class="text-lg font-semibold text-white flex items-center mb-4"><span class="text-2xl mr-2">üöõ</span>Dashboard 3 ‚Äî Control de Transporte de Material</h3>
                    <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Camiones operativos</p>
                            <p class="text-3xl font-bold text-white">${plantaLoBlanco.dashboard3.operationalTrucks}</p>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Viajes diarios promedio</p>
                            <p class="text-3xl font-bold text-white">${plantaLoBlanco.dashboard3.averageTrips}</p>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Toneladas transportadas (d√≠a)</p>
                            <p class="text-3xl font-bold text-white">${plantaLoBlanco.dashboard3.dailyTonnage.toLocaleString('es-CL')} t</p>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Empresas registradas</p>
                            <p class="text-sm font-semibold text-[#D4A24E]">${plantaLoBlanco.dashboard3.companies.join(', ')}</p>
                        </div>
                    </div>
                    <div class="mt-6 bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <h4 class="text-md font-semibold text-white">Detalle de cami√≥n destacado</h4>
                            <ul class="mt-4 text-sm text-gray-300 space-y-2">
                                <li><span class="text-gray-400">Patente:</span> ${plantaLoBlanco.dashboard3.highlightedTruck.plate}</li>
                                <li><span class="text-gray-400">Material:</span> ${plantaLoBlanco.dashboard3.highlightedTruck.material}</li>
                                <li><span class="text-gray-400">Capacidad:</span> ${plantaLoBlanco.dashboard3.highlightedTruck.capacity} m¬≥</li>
                                <li><span class="text-gray-400">Vueltas hoy:</span> ${plantaLoBlanco.dashboard3.highlightedTruck.dailyRuns}</li>
                                <li><span class="text-gray-400">Transporte acumulado semanal:</span> ${plantaLoBlanco.dashboard3.highlightedTruck.weeklyVolume.toLocaleString('es-CL')} m¬≥</li>
                            </ul>
                        </div>
                        <div class="bg-gray-900/40 rounded-lg p-4 flex flex-col items-center justify-center text-center">
                            <div class="w-20 h-20 bg-gray-700 rounded-full mb-4 flex items-center justify-center">
                                <i data-feather="activity" class="w-10 h-10 text-[#D4A24E]"></i>
                            </div>
                            <p class="text-sm text-gray-400">Tarjetas por cami√≥n con indicador de rendimiento individual y acceso a fotograf√≠as de tolva inspeccionadas por IA.</p>
                        </div>
                    </div>
                </section>

                <section class="mb-10">
                    <h3 class="text-lg font-semibold text-white flex items-center mb-4"><span class="text-2xl mr-2">‚öôÔ∏è</span>Dashboard 4 ‚Äî Monitoreo de Buz√≥n Alimentador</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Volumen alimentado diario</p>
                                    <p class="text-2xl font-bold text-white">${plantaLoBlanco.dashboard4.dailyVolume.toLocaleString('es-CL')} m¬≥</p>
                                </div>
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Consumo por minuto</p>
                                    <p class="text-2xl font-bold text-white">${plantaLoBlanco.dashboard4.perMinute.toFixed(2)} m¬≥/min</p>
                                </div>
                                <div class="bg-gray-900/40 p-4 rounded-md">
                                    <p class="text-xs text-gray-400">Promedio semanal</p>
                                    <p class="text-2xl font-bold text-white">${plantaLoBlanco.dashboard4.weeklyAverage.toLocaleString('es-CL')} m¬≥</p>
                                </div>
                            </div>
                            <div class="mt-6">
                                <h4 class="text-sm font-semibold text-white mb-2">Anomal√≠as detectadas</h4>
                                <ul class="text-xs text-yellow-400 space-y-1">
                                    ${plantaLoBlanco.dashboard4.anomalies.map(anomaly => `<li class="flex items-start"><span class="mr-2">‚Ä¢</span>${anomaly}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <h4 class="text-md font-semibold text-white mb-4">Composici√≥n por tipo de √°rido</h4>
                            <div class="chart-container h-64"><canvas id="buzonPieChart"></canvas></div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <h4 class="text-md font-semibold text-white mb-4">Rendimiento horario</h4>
                            <div class="chart-container h-64"><canvas id="buzonTrendChart"></canvas></div>
                        </div>
                    </div>
                </section>

                <section class="mb-10">
                    <h3 class="text-lg font-semibold text-white flex items-center mb-4"><span class="text-2xl mr-2">üóª</span>Dashboard 5 ‚Äî Monitoreo Volum√©trico de Acopios</h3>
                    <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="text-gray-400 border-b border-gray-700">
                                        <th class="py-2">#</th>
                                        <th class="py-2">Producto</th>
                                        <th class="py-2">Cota Piso (m)</th>
                                        <th class="py-2">Volumen (m¬≥)</th>
                                        <th class="py-2">Variaci√≥n mensual</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${plantaLoBlanco.dashboard5.stockpiles.map((stockpile, index) => `
                                        <tr class="border-b border-gray-800 text-gray-200">
                                            <td class="py-3">${index + 1}</td>
                                            <td class="py-3 font-semibold">${stockpile.producto}</td>
                                            <td class="py-3">${stockpile.cota}</td>
                                            <td class="py-3">${stockpile.volumen.toLocaleString('es-CL')}</td>
                                            <td class="py-3 ${stockpile.variacion > 0 ? 'text-green-400' : stockpile.variacion < 0 ? 'text-red-400' : 'text-gray-300'}">${stockpile.variacion > 0 ? '+' : ''}${stockpile.variacion}%</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300">
                            ${plantaLoBlanco.dashboard5.notes.map(note => `<div class="bg-gray-900/40 p-4 rounded-md">${note}</div>`).join('')}
                        </div>
                    </div>
                </section>

                <section class="mb-10">
                    <h3 class="text-lg font-semibold text-white flex items-center mb-4"><span class="text-2xl mr-2">üåê</span>Dashboard 6 ‚Äî Reporte Ejecutivo</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Producci√≥n total mes</p>
                            <p class="text-3xl font-bold text-white">${plantaLoBlanco.dashboard6.monthlyProduction.toLocaleString('es-CL')} m¬≥</p>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Ingresos proyectados</p>
                            <p class="text-3xl font-bold text-white">$${plantaLoBlanco.dashboard6.projectedRevenue.toLocaleString('es-CL')}</p>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Costo operativo promedio</p>
                            <p class="text-3xl font-bold text-white">$${plantaLoBlanco.dashboard6.averageCost.toLocaleString('es-CL')}/m¬≥</p>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Margen operativo</p>
                            <p class="text-3xl font-bold text-green-400">${plantaLoBlanco.dashboard6.operatingMargin}%</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Dron activo</p>
                            <p class="text-sm font-semibold text-white">${plantaLoBlanco.dashboard6.droneStatus}</p>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg">
                            <p class="text-sm text-gray-400">Sensores en l√≠nea</p>
                            <p class="text-2xl font-bold text-white">${plantaLoBlanco.dashboard6.sensorsOnline.active}/${plantaLoBlanco.dashboard6.sensorsOnline.total}</p>
                            <p class="text-xs text-gray-500 mt-2">Integraci√≥n SCADA + IoT para seguimiento de disponibilidad.</p>
                        </div>
                    </div>
                </section>
            `;

            if (mainChart) mainChart.destroy();
            if (arconesChart) arconesChart.destroy();
            if (buzonPieChart) buzonPieChart.destroy();
            if (buzonTrendChart) buzonTrendChart.destroy();

            const flowCtx = document.getElementById('flowChart').getContext('2d');
            const flowDatasets = Object.entries(plantaLoBlanco.dashboard1.lineChart.datasets).map(([label, data], index) => {
                const colors = ['#D4A24E', '#60A5FA', '#A855F7', '#34D399'];
                return {
                    label,
                    data,
                    borderColor: colors[index % colors.length],
                    backgroundColor: `${colors[index % colors.length]}33`,
                    tension: 0.35,
                    fill: false,
                    pointRadius: 3,
                    pointHoverRadius: 5
                };
            });
            mainChart = new Chart(flowCtx, {
                type: 'line',
                data: {
                    labels: plantaLoBlanco.dashboard1.lineChart.labels,
                    datasets: flowDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#D1D5DB' } } },
                    scales: {
                        x: {
                            ticks: { color: 'rgba(209, 213, 219, 0.8)' },
                            grid: { color: 'rgba(75, 85, 99, 0.3)' }
                        },
                        y: {
                            ticks: { color: 'rgba(209, 213, 219, 0.8)' },
                            grid: { color: 'rgba(75, 85, 99, 0.3)' }
                        }
                    }
                }
            });

            const arconesCtx = document.getElementById('arconesChart').getContext('2d');
            arconesChart = new Chart(arconesCtx, {
                type: 'bar',
                data: {
                    labels: plantaLoBlanco.dashboard2.arcones.map(a => a.id),
                    datasets: [
                        {
                            label: 'Volumen inicial',
                            data: plantaLoBlanco.dashboard2.arcones.map(a => a.inicial),
                            backgroundColor: 'rgba(96, 165, 250, 0.6)'
                        },
                        {
                            label: 'Volumen final',
                            data: plantaLoBlanco.dashboard2.arcones.map(a => a.final),
                            backgroundColor: 'rgba(212, 162, 78, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#D1D5DB' } } },
                    scales: {
                        x: {
                            ticks: { color: 'rgba(209, 213, 219, 0.8)' },
                            grid: { color: 'rgba(75, 85, 99, 0.2)' }
                        },
                        y: {
                            ticks: { color: 'rgba(209, 213, 219, 0.8)' },
                            grid: { color: 'rgba(75, 85, 99, 0.2)' }
                        }
                    }
                }
            });

            const buzonPieCtx = document.getElementById('buzonPieChart').getContext('2d');
            buzonPieChart = new Chart(buzonPieCtx, {
                type: 'doughnut',
                data: {
                    labels: plantaLoBlanco.dashboard4.composition.labels,
                    datasets: [{
                        data: plantaLoBlanco.dashboard4.composition.values,
                        backgroundColor: ['#F59E0B', '#3B82F6', '#6B7280'],
                        borderColor: '#1F2937'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#D1D5DB' } } }
                }
            });

            const buzonTrendCtx = document.getElementById('buzonTrendChart').getContext('2d');
            buzonTrendChart = new Chart(buzonTrendCtx, {
                type: 'line',
                data: {
                    labels: plantaLoBlanco.dashboard4.hourlyPerformance.labels,
                    datasets: [{
                        label: 'm¬≥/min',
                        data: plantaLoBlanco.dashboard4.hourlyPerformance.values,
                        borderColor: '#34D399',
                        backgroundColor: 'rgba(52, 211, 153, 0.2)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            ticks: { color: 'rgba(209, 213, 219, 0.8)' },
                            grid: { color: 'rgba(75, 85, 99, 0.2)' }
                        },
                        y: {
                            ticks: { color: 'rgba(209, 213, 219, 0.8)' },
                            grid: { color: 'rgba(75, 85, 99, 0.2)' }
                        }
                    }
                }
            });

            feather.replace();
        }

        function renderUserManagement() {
            const client = mockData.clients[currentClient];
            if (!client) return;

            document.getElementById('main-title').textContent = `Usuarios de ${client.name}`;
            dashboardContent.innerHTML = `
                <div class="bg-gray-800 rounded-lg shadow-lg border border-gray-700">
                    <div class="p-6 border-b border-gray-700 flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-white">Listado de Usuarios</h3>
                        <button class="bg-[#D4A24E] text-gray-900 px-4 py-2 rounded-md font-semibold hover:bg-[#E4B56E] btn flex items-center">
                           <i data-feather="plus" class="w-4 h-4 mr-2"></i> Agregar Usuario
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full table">
                            <thead class="bg-gray-700/50">
                                <tr>
                                    <th class="text-gray-400">Nombre</th>
                                    <th class="text-gray-400">Email</th>
                                    <th class="text-gray-400">Estado</th>
                                    <th class="text-gray-400">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body" class="divide-y divide-gray-700"></tbody>
                        </table>
                    </div>
                </div>
            `;
            const usersTableBody = document.getElementById('users-table-body');
            usersTableBody.innerHTML = client.users.map(user => `
                <tr class="hover:bg-gray-700/50">
                    <td class="text-white">${user.name}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="px-3 py-1 text-xs font-medium rounded-full ${user.active ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}">
                            ${user.active ? 'Activo' : 'Inactivo'}
                        </span>
                    </td>
                    <td class="flex items-center space-x-2 py-4">
                        <button title="Editar" class="text-gray-500 hover:text-[#D4A24E]"><i data-feather="edit-2" class="w-5 h-5"></i></button>
                        <button title="${user.active ? 'Desactivar' : 'Activar'}" class="text-gray-500 ${user.active ? 'hover:text-red-500' : 'hover:text-green-500'}">
                            ${user.active ? '<i data-feather="toggle-left" class="w-5 h-5"></i>' : '<i data-feather="toggle-right" class="w-5 h-5"></i>'}
                        </button>
                    </td>
                </tr>
            `).join('');

            feather.replace();
        }

        // --- INICIALIZACI√ìN GENERAL ---
        feather.replace();

    </script>
</body>
</html>

